@using Microsoft.AspNetCore.Http.Extensions
@using MrCMS.Web.Apps.Core.Models
@model SubMenu
@{
    var indexOf = ViewData["indexOf"] as IEnumerable<int> ?? Enumerable.Empty<int>();
    var currentUrl = Context.Request.GetDisplayUrl();
    var nav = ViewData["submenu"] as string;
    List<ChildMenuItem> items = Model.Where(menuItem => menuItem.CanShow).ToList();
}

<ul class="nav flex-column collapse" data-menu="true" id="@nav" aria-expanded="false">
    @foreach (ChildMenuItem item in items)
    {
        if (item.Children != null && item.Children.Any())
        {
            int index = items.IndexOf(item);
            indexOf = indexOf.Concat(new List<int> { index });
            ViewData["indexOf"] = indexOf;
            ViewData["item"] = item.Text;
            <li class="nav-item @(currentUrl.Equals(item.Url, StringComparison.OrdinalIgnoreCase) ? "active" : "")" data-menu="@string.Join("-", indexOf)">
                <a href="@item.Text" collapsed nav-link" data-toggle="collapse" data-target="#@item.Text">
                    @Html.Resource("Nav Links - " + item.Text, item.Text)
                    <b class="caret"></b>
                </a>
                <partial name="Components/NavLinks/SubMenu" model="item.Children" view-data="ViewData"></partial>
            </li>
        }
        else
        {
            <li class="@(currentUrl.Equals(item.Url, StringComparison.OrdinalIgnoreCase) ? "active" : "")  nav-item"> <a href="@item.Url" class="nav-link">@item.Text</a></li>
        }
    }
</ul>
