@using Microsoft.AspNetCore.Http.Extensions
@using MrCMS.Web.Apps.Core.Models
@model SubMenu
@{
    var indexOf = ViewData["indexOf"] as IEnumerable<int> ?? Enumerable.Empty<int>();
    var currentUrl = Context.Request.GetDisplayUrl();
    List<ChildMenuItem> items = Model.Where(menuItem => menuItem.CanShow).ToList();
}

<ul class="nav flex-column dropdown-menu" data-menu="true">
    @foreach (ChildMenuItem item in items)
    {
        if (item.Children != null && item.Children.Any())
        {
            int index = items.IndexOf(item);
            indexOf = indexOf.Concat(new List<int> { index });
            ViewData["indexOf"] = indexOf;
            <li class="dropdown-submenu nav-link @(currentUrl.Equals(item.Url, StringComparison.OrdinalIgnoreCase) ? "active" : "")" data-menu="@string.Join("-", indexOf)">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown-mrcms">
                    @Html.Resource("Nav Links - " + item.Text, item.Text)
                    <b class="caret"></b>
                </a>
                <partial name="Components/NavLinks/SubMenu" model="item.Children" view-data="ViewData"></partial>
            </li>
        }
        else
        {
            <li class="@(currentUrl.Equals(item.Url, StringComparison.OrdinalIgnoreCase) ? "active" : "")  nav-link"> <a href="@item.Url">@item.Text</a></li>
        }
    }
</ul>
