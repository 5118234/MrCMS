@using Microsoft.AspNetCore.Http.Extensions
@using MrCMS.Web.Apps.Core.Models
@model SubMenu
@{
    var indexOf = ViewData["indexOf"] as string;
    var currentUrl = Context.Request.Path.Value;
    var nav = ViewData["submenu"] as string;
    List<ChildMenuItem> items = Model.Where(menuItem => menuItem.CanShow).ToList();
}
<ul class="nav nav-treeview" id="@nav" aria-expanded="false">
    @foreach (ChildMenuItem item in items)
    {
        if (item.Children != null && item.Children.Any())
        {
            int index = items.IndexOf(item);
            ViewData["submenu"] = item.Text;
            indexOf = indexOf + index.ToString();
            ViewData["indexOf"] = indexOf;
            ViewData["item"] = item.Text;

            <li class="nav-item has-treeview" data-menu="@indexOf.ToString()">
                <a href="#" class="nav-link @(currentUrl.Equals(item.Url, StringComparison.OrdinalIgnoreCase) ? "active" : "")">
                    <i class="fa  @(indexOf.Length > 1 ? "fa-circle" : "fa-circle-o") nav-icon"></i>    
                    <p>@Html.Resource("Nav Links - " + item.Text, item.Text)
                        <i class="fa fa-angle-left right"></i>
                    </p>
                </a>

                <partial name="Components/NavLinks/SubMenu" model="item.Children" view-data="ViewData"></partial>
            </li>
        }
        else
        {
            <li class="nav-item">
                <a href="@item.Url" class="nav-link @(currentUrl.Equals(item.Url, StringComparison.OrdinalIgnoreCase) ? "active" : "")">
                    <i class="fa fa-circle-o nav-icon"></i>
                    <p>
                        @item.Text
                    </p>
                </a>
            </li>
        }
    }
</ul>